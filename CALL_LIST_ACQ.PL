
# FILE: call_list_acq.PL
# This program is written chiefly by Xiaowen Huang of Vector Research Inc.
# originally for Georgetown University Law Library.
# modified by Michael Poulin - 6/22/00 
# modified by Tom Keays - 9/19/16 

######################   Revision History:  ######################
#
# Revised 12/06/99.
# In the converted html output, if two new titles have the exact same
# first subject heading, then only the first one will appear in the list.
# I have modified the script so it will display all of the new
# titles sharing a subject heading, grouped under that heading.
#
# Revised 6/22/00
# modified for Le Moyne College to output by call number - mwp
#
# Revised 08/23/03 - mwp
#
# Revised 10/4/10 - tk - new format of html page.
# modified because the publisher and date info was merged and to link
# based on record number not OCLC number.
#
# Revised 11/25/13 - tk
# new 264 field sometimes introduced a second PUBLISHER line.
# modified to test for this and eliminate unnecessary line
#
# Revised 5/5/14 - tk
# Location ljr = "Jesuit Residence"
#
# Revised 9/19/16 - tk
# revised regex replace on unicode characters (which replaces III's proprietary 
# way to store diacritical characters)
#
#####################   END Revision History  ####################

# This program will take a particular kind of review file listing
# from an Innopac (called "newcall.txt" and generate an HTML file
# called "newcall.html"

# It is important that when you output the review file that you set the
# List Options for "Print field labels for variable length fields" to "y",
# "Number items in list?" to "n", and "Print TITLE all in upper case?" to 
# "n".  These options are found right before you start the print. 

# The fields that this script will recognize and output to HTML are:
# c -- call no. (from ITEM record)
# t -- title
# p -- imprint
# r -- record number

# You will need to configure the script to create links for
# your catalog. This is pretty easy--all you need to do is to 
# edit the line in the RECORD # AND LINK TO CATALOG section which
# looks like:
# $x="<a href=\"http://123.123.45.45/record=$y\">
# just change the IP address to the IP address of your Webpac server.

# If you wish, you can adjust what appears at the top and bottom of the
# HTML file that is generated by adding HTML code to the
# INSERT HEADER and INSERT FOOTER sections

# Do this and you should be ready to go.


#!/usr/bin/perl

$date = "August 2010";

# OPEN THE REVIEW FILE FOR READING
open (IN,"newcall.txt") || die "Couldn't open file 'newcall.txt' to write: $!\n";


# OPEN THE OUTPUT HTML FILE
# You can adjust this filename so that it outputs the file
# to a particular directory for publishing to your web site
open (OUT,">newcall.html") || die "I am not able to write to newcall.html";

# OPEN TWO TEMPORARY FILES TO STORE MODIFIED INPUT FILE
open (TM1, ">temp1.txt") || die "Couldn't open file 'temp1.txt' to write: $!\n";
open (TM2, ">temp2.txt") || die "Couldn't open file 'temp2.txt' to write: $!\n";

#INITIALIZE A HASH ARRAY AND CREATE AN ALPHABETIC ARRAY.
%ahash = {};
#change for LC/NLM class system
@alphas = (A..H,J..N,P..W,Z);

# If one subject split into two or more lines, then merge them
# into one line. (to make sure one subject per line).

{
    local $/ = 'CALL NO. =';
    while (<IN>) {
      chomp;
      /^[\s]+$/ and next;
      if (/TITLE =/) {
        my @titles = split 'TITLE';
        $titles[0] =~ s/\n/ /g;
	  my $line2 = join "\nTITLE", @titles;
        print TM1 "CALL NO. =$line2\n";
      }
      elsif ( s/\n/ /g ) {
        print TM1 "CALL # =$_\n";
      }
    }
  }
close(IN);
close(TM1);

open (TM1, "temp1.txt") || die "Couldn't open file 'temp1.txt' to write: $!\n";

#ELIMINATE EXTRA SUBJECT HEADINGS
#This script will only keep the main subject heading for each title

$count=0;
  while (<TM1>){
    chomp;
    if (/CALL NO. = /) {
      $count or print TM2 "$_\n";
      $count++;
    }
    else {
      print TM2 "$_\n";
      $count = 0;
    }
  }
close(TM1);
close(TM2);

#OPEN THE TEMPORARY FILE TO READ
open(TM2,"temp2.txt") || die "couldn't open temp2.txt to read\n";

#READ IN THE INFORMATION and put them into the hash array.
#so for each subject, there are corresponding contents.

{ local $/ = "CALL NO. = ";
  while (<TM2>) {
      chomp;

#Converting INNOPAC's unicode into HTML character entities: 
s/\{u([a-zA-Z0-9]{4,5})\}/&#x$1;/ig;

s/\{\d\d\d\}//g;
if (s/(.+?)(?=\n[A-Z]+ =)//s) {
          (my $x = $1) =~ tr/\na-z/ A-Z/;
	    $x =~ s/\{\d\d\d\}//g;
          $callno = $x;
	    #save the call number for printing in each record
	    $q = $x;
	    chop($q);
	    chop($q);
	    chop($q);
          # only 1 or 2 alphas-	    
	    $callno =~ s/^[\s]+//; 
	    #strip off just the first two digits
          $callno =~ s/(^\w\w)[\d\D]+/$1/;
	    #translate any digits to blanks
	    $callno =~ tr/[0-9]/ /;
	}

if (s/.*?TITLE = (.+?)\n(?=PUBLISHER =)//s) {
          (my $x = $1) =~ tr/\n/ /;
            $ahash{$callno} = $ahash{$callno}."<p><b>$x</b><br>\n";
            $singlepubl = 1;
      }
if (s/.*?PUBLISHER = (.+?)\n(?=PUBLISHER =)//s) {
          (my $x = $1) =~ tr/\n/ /;
		chop($x);
	   	$c=$x;
           	$ahash{$callno} = $ahash{$callno}. " $c\n";
           	$singlepubl = 0;
      }
if (s/.*?PUBLISHER = (.+?)(?=RECORD # =)//s) {
          (my $x = $1) =~ tr/\n/ /;
		chop($x);
	   	$c=$x;
            if ($singlepubl) {
            	$ahash{$callno} = $ahash{$callno}. " $c\n";
           	}
      }
if (s/.*?RECORD # = (.+?)(?=LOCATION =)//s) {
          (my $x = $1) =~ tr/\n/ /;
	    chop($x);
	    $y=$x;
          chop($y);
          chop($y);  
          $y=~s/ /+/g;
      }
if (s/.*?LOCATION = (.+?)\n//s) {
          (my $x = $1) =~ tr/\n/ /;
	    chop($x);
	    chop($x);
          $loc = $x;
          if($x =~ /lrefs/) {
            $loc = "Reference: Stacks ";
          }
          if($x =~ /lrefd/) {
            $loc = "Reference: Desk ";
          }
          if($x =~ /ltm/) {
            $loc = "Teaching Material ";
          }
          if($x =~ /lmvc/) {
            $loc = "Media: Videorecording ";
          }
          if($x =~ /lmcod/) {
            $loc = "Media: Compact Disc ";
          }
          if($x =~ /lbks/) {
            $loc = "Bookstacks ";
          }
          if($x =~ /lasc/) {
            $loc = "Academic Support Center ";
          }
          if($x =~ /ljr/) {
            $loc = "Jesuit Residence ";
          }
          if($x =~ /lrsvm/) {
            $loc = "Reserves: Media ";
          }
          if($x =~ /lrsvc/) {
            $loc = "Reserves ";
          }
          if($x =~ /lmt/) {
            $loc = "Media: Test ";
          }
          if($x =~ /lnet/) {
            $loc = "Network Info Resources ";
          }
          if($x =~ /lscla/) {
            $loc = "Special: Le Moyne Authors ";
          }

           	$ahash{$callno} = $ahash{$callno}. "<br>$loc ";

     	      #print the call number saved from above
		$ahash{$callno} = $ahash{$callno}. "<a href=\"http://library.lemoyne.edu/record=$y\" target=\"_blank\">$q</a></p>\n";

     }
  }
}
close(TM2);

#INSERT HEADER
#You can change this section to suit your particular library
#Any HTML code that you type in between <<EOM and EOM will
#appear at the top of the HTML page that is created.

print OUT <<EOM;
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Le Moyne College Library :: Recent Library Acquisitions by Classification Number</title>
<link rel="stylesheet" href="http://library.lemoyne.edu/screens/newbooks.css" type="text/css">
<link rel="stylesheet" href="http://library.lemoyne.edu/screens/banner-nav.css" type="text/css">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js" type="text/javascript"></script>
<script src="http://library.lemoyne.edu/screens/superfish.js" type="text/javascript"></script>
<script src="http://library.lemoyne.edu/screens/banner-loader.js" type="text/javascript"></script>
</head>

<body>

<!-- start lmc-banner ==== rev 2017-05-02 ================== -->

    <div id="lmc-banner">
      <div id="lmc-banner-header">
        <h2 id="lmc-banner-name"><a href="http://resources.library.lemoyne.edu/library"><img src="http://6423ab35994a822f653e-1cba4c36ec78f50a350878d40a7c96c2.r6.cf1.rackcdn.com/assets/img/banner-library-logo.png" alt="Noreen Reale Falcone Library"></a></h2>
        <div id="lmc-banner-logo"><a href="http://lemoyne.edu/"><img src="http://6423ab35994a822f653e-1cba4c36ec78f50a350878d40a7c96c2.r6.cf1.rackcdn.com/assets/img/banner-lmc-logo.png" alt="Le Moyne College"></a></div>
        <ul id="lmc-banner-nav" class="sf-menu">
          <li id="home"><a href="http://resources.library.lemoyne.edu/library">Home</a></li>
          <li id="books"><a href="http://resources.library.lemoyne.edu/find-books">Find Books</a>
            <ul>
              <li><a href="http://library.lemoyne.edu/search">Catalog</a></li>
              <li><a href="http://resources.library.lemoyne.edu/about/circulation">Circulation Policies</a></li>
              <li><a href="http://www.connectny.info/" target="_blank">Connect NY</a></li>
              <li><a href="http://resources.library.lemoyne.edu/pubserv-ill">Interlibrary Loan</a></li>
              <li><a href="http://library.lemoyne.edu/screens/newbooks.html">New Titles</a></li>
              <li><a href="http://goo.gl/forms/ZT9xXRaS9X" target="_blank">Suggest a Purchase</a></li>
            </ul>
          </li>
          <li id="articles"><a href="http://resources.library.lemoyne.edu/find-articles">Find Articles</a>
            <ul>
              <li><a href="http://resources.library.lemoyne.edu/subjects-AllByName">Databases by Name</a></li>
              <li><a href="http://resources.library.lemoyne.edu/pubserv-ill">Interlibrary Loan</a></li>
              <li><a href="http://wp8kk7mz7x.search.serialssolutions.com/">Journal Finder</a></li>
            </ul>
          </li>
          <li id="guides" class="activetab"><a href="http://resources.library.lemoyne.edu/guides">Research Guides</a>
            <ul>
              <li><a href="http://resources.library.lemoyne.edu/guides/subject">Subject Guides</a></li>
              <li><a href="http://resources.library.lemoyne.edu/guides/course">Course Guides</a></li>
              <li><a href="http://resources.library.lemoyne.edu/pubserv-faculty">Faculty Support</a></li>
              <li><a href="http://resources.library.lemoyne.edu/pubserv-copyright">Copyright Essentials</a></li>
              <li><a href="http://resources.library.lemoyne.edu/citing-sources">Citing Sources</a></li>
              <li><a href="http://resources.library.lemoyne.edu/mendeley">Mendeley</a></li>
              <li><a href="http://resources.library.lemoyne.edu/refworks">RefWorks</a></li>
              <li><a href="http://resources.library.lemoyne.edu/pubserv-instruction">Library Instruction</a></li>
            </ul>
          </li>
          <li id="reserves"><a href="http://resources.library.lemoyne.edu/pubserv-reserves">Course Reserves</a>
            <ul>
              <li><a href="http://resources.library.lemoyne.edu/pubserv-reserves/faculty">Faculty</a></li>
              <li><a href="http://resources.library.lemoyne.edu/pubserv-reserves/student">Students</a></li>
            </ul>
          </li>
          <li id="about"><a href="http://resources.library.lemoyne.edu/about">About Us</a>
            <ul>
              <li><a href="http://lemoynelibrary.org/news/">Events & Announcements</a></li>
              <li><a href="http://resources.library.lemoyne.edu/about/hours">Hours of Service</a></li>
              <li><a href="http://resources.library.lemoyne.edu/about/library-services">Library Services</a></li>
              <li><a href="http://resources.library.lemoyne.edu/pubserv-rooms">Reserve a Room</a></li>
              <li><a href="http://resources.library.lemoyne.edu/about/visit">Visit the Library</a></li>
              <li><a href="http://resources.library.lemoyne.edu/wilson-gallery">Wilson Gallery</a></li>
              <li><a href="http://resources.library.lemoyne.edu/arts/de-ropp-polish-art-collection">de Ropp Polish Art Collection</a></li>
            </ul>
          </li>
          <li id="askus"><a href="http://resources.library.lemoyne.edu/askus">Ask Us!</a>
            <ul>
              <li><a href="http://resources.library.lemoyne.edu/askus/by-chat">Ask Us by Chat</a>
              <li><a href="http://resources.library.lemoyne.edu/askus/by-email">Ask Us by Email</a>
              <li><a href="http://resources.library.lemoyne.edu/askus/by-text">Ask Us by Text</a>
              <li><a href="http://resources.library.lemoyne.edu/askus/by-phone">Ask Us by Phone</a>
              <li><a href="http://resources.library.lemoyne.edu/askus/in-person">Ask Us in Person</a>
              <li><a href="http://ask.library.lemoyne.edu/">Ask Us FAQ</a>
              <li><a href="http://resources.library.lemoyne.edu/contact">Ask a Librarian</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>

<!-- end lmc-banner ======================================== -->

<br>

<!--content-->
<div id="content">
<h1 align="center">Recent Library Acquisitions by Classification Number 
<br> XXXXXXX 2019 </h1>

<!--  Page Navigation Links -->
<hr>
<table width="100%">
<tr><td><a name="aleph"></a><b>Classification numbers:</b></td>
    <td align="right"><a href="newbooks.html"><b>Home</b></a></td></tr>
</table>
<p style="text-align:center; width:90%">
  <a href="#A">A&nbsp;-&nbsp;general</a>&nbsp;::
  <a href="#B">B&nbsp;-&nbsp;philosophy,&nbsp;psychology,&nbsp;religion</a>&nbsp;::
  <a href="#C">C&nbsp;-&nbsp;biography&nbsp;</a>&nbsp;::
  <a href="#D">D&nbsp;-&nbsp;history</a>&nbsp;::
  <a href="#E">E&nbsp;-&nbsp;history&nbsp;-&nbsp;United&nbsp;States</a>&nbsp;::
  <a href="#F">F&nbsp;-&nbsp;history&nbsp;-&nbsp;individual&nbsp;states,&nbsp;other&nbsp;North&nbsp;American&nbsp;countries</a>&nbsp;::
  <a href="#G">G&nbsp;-&nbsp;anthropology&nbsp;and&nbsp;geography</a>&nbsp;::
  <a href="#H">H&nbsp;-&nbsp;business,&nbsp;economics,&nbsp;sociology</a>&nbsp;::
  <a href="#J">J&nbsp;-&nbsp;political&nbsp;science</a>&nbsp;::
  <a href="#K">K&nbsp;-&nbsp;law</a>&nbsp;::
  <a href="#L">L&nbsp;-&nbsp;education</a>&nbsp;::
  <a href="#M">M&nbsp;-&nbsp;music</a>&nbsp;::
  <a href="#N">N&nbsp;-&nbsp;art</a>&nbsp;::
  <a href="#P">P&nbsp;-&nbsp;literature&nbsp;and&nbsp;film</a>&nbsp;::
  <a href="#Q">Q&nbsp;-&nbsp;sciences</a>&nbsp;::
  <a href="#R">R&nbsp;-&nbsp;medicine</a>&nbsp;::
  <a href="#S">S&nbsp;-&nbsp;agriculture</a>&nbsp;::
  <a href="#T">T&nbsp;-&nbsp;engineering&nbsp;and&nbsp;technology</a>&nbsp;::
  <a href="#U">U&nbsp;-&nbsp;military&nbsp;science</a>&nbsp;::
  <a href="#V">V&nbsp;-&nbsp;naval&nbsp;science</a>&nbsp;::
  <a href="#W">W&nbsp;-&nbsp;medicine&nbsp;(NLM&nbsp;classification)</a>&nbsp;::
  <a href="#Z">Z&nbsp;-&nbsp;library&nbsp;science</a></p>
<p>
<hr>

EOM

#INSERT INFORMATION INTO EACH ALPHABETIC GROUP.

foreach $alpha (@alphas) {
   print OUT "<h2 id=\"$alpha\" style=\"text-align:center\">- <a href=\"#aleph\">$alpha</a> -</h2>\n";
   foreach $call (sort keys %ahash) {
	if ($call =~ /^HASH/) {
	next;
	}
   if ($call=~ /^$alpha/i) {
	print OUT "<h3><a href=\"#aleph\">$call</a></h3>\n",$ahash{$call},"\n";
	}
    }
}

# INSERT FOOTER
# anything that you add between the EOM; and EOM will appear
# at the bottom of the HTML file that is created
print OUT <<EOM;
</div>

<!--footer-->
<div id="ft">
<p><a href="http://resources.library.lemoyne.edu/library">Le Moyne College Library</a> | 1419 Salt Springs Road, Syracuse, NY 13214 | 315-445-4153 </p>
</div>

</body>
</html>

EOM
close(OUT);
# FINISHED

